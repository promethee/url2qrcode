<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Url2qrcode by promethee</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Url2qrcode</h1>
        <p>a simple way to get an url in qr : unplugged url sharing</p>

        <p class="view" style="display:none;"><a href="https://github.com/promethee/url2qrcode">View the Project on GitHub <small>promethee/url2qrcode</small></a></p>


        <ul style="display:none;">
          <li><a href="https://github.com/promethee/url2qrcode/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/promethee/url2qrcode/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/promethee/url2qrcode">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>
          <h3>Put any url in the field below</h3>
          <input type="url" id="qr-input" placeholder="http://whatever.com" size="100"/>
        </p>
        <p>
          <table>
            <tbody>
              <tr>
                <td><h4>default</h4></td>
                <td><h4>getPocket</h4></td>
              </tr>
              <tr>
                <td><div id="qr-result"></div></td>
                <td><div id="qr-pocket"></div></td>
              </tr>
            </tbody>
          </table>
        </p>
        <p>Because sometimes, you may want to open an url without using anything connected to an account.<br/>Transmit an url to your phone, without sync, pushbullet, etc.</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/promethee">promethee</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
        <script>
            var externalWrapper = {
              'pocket': {
                url: 'https://getpocket.com/edit?url='
              }
            };
            var wantWrapper = function wantWrapper(url) {
              var wantGetPocket = -1 < url.indexOf('type=pocket');
              console.log('wantGetPocket', wantGetPocket, url.indexOf('type=pocket'));
              if (wantGetPocket) {
                url = url.split('?url=')[1].split('&=typepocket')[0];
                console.log('externalWrapper.pocket.url+url', externalWrapper.pocket.url+url);
                return externalWrapper.pocket.url+url;
              } else {
                return false;
              }
            };
            var mkQr = function mkQr(url) {
                if (!document.getElementById('qrcode')) {
                    var qrDiv = document.createElement('div');
                    qrDiv.id = 'qrcode';
                    document.getElementById('qr-result').appendChild(qrDiv);
                }
                if (!document.getElementById('qrcode-pocket')) {
                    var qrDiv2 = document.createElement('div');
                    qrDiv2.id = 'qrcode-pocket';
                    document.getElementById('qr-pocket').appendChild(qrDiv2);
                }
                document.getElementById('qr-input').value = url;
                $('#qrcode').html('').qrcode(url);
                var pocketUrl = wantWrapper(window.location.href);
                if (pocketUrl) {
                  $('#qrcode-pocket').html('').qrcode(pocketUrl);
                }
            };
            
            var onNewQrCode = function onNewQrCode(url) {
                url = url && !url.target ? url:document.getElementById('qr-input').value;
                mkQr(url)
            };
            
            var getUrlFromLocation = function getUrlFromLocation() {
              var v = window.location;
              var r = document.referrer;
              var s = window.location.search;
              if (window.location.search) {
                var url = window.location.search.split('?')[1].split('=')[1];
                if (url) {
                  mkQr(url)
                } else {
                  mkQr(r);
                }
              }  else {
                mkQr(r);
              }
            };
            getUrlFromLocation();
            ['change', 'blur', 'focus', 'keyup'].map(function (event) {
              document.getElementById('qr-input').addEventListener(event, onNewQrCode);  
            });
        </script>
  </body>
</html>
